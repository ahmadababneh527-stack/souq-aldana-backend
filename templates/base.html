{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}سوق الدانة{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% block head_extra %}{% endblock %}
</head>
<body> 
    <div id="spinner-overlay" class="spinner-overlay">
        <div class="spinner"></div>
    </div>

    <div id="notification" class="notification"></div>

    <header class="main-header">
        <div class="container">
            <a href="{% url 'index' %}" class="logo-container">
                <img src="{% static 'images/special_offer.png' %}" alt="شعار سوق الدانة" class="logo-img">
                <h1 class="logo-text">سوق الدانة</h1>
            </a>
            
            <nav class="desktop-nav">
                <ul>
                    <li><a href="{% url 'index' %}">الرئيسية</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropbtn">الأقسام <i class="fa fa-caret-down"></i></a>
                        <div class="dropdown-content">
                            {% for category in categories %}
                                <a href="{% url 'category_products' category.slug %}">{{ category.name }}</a>
                            {% endfor %}
                        </div>
                    </li>
                    <li><a href="{% url 'cart' %}">سلة المشتريات (<span id="cart-count">0</span>)</a></li>
                    <li id="signup-link"><a href="{% url 'signup' %}">إنشاء حساب</a></li>
                    <li id="login-link"><a href="{% url 'login' %}">تسجيل الدخول</a></li>
                    <li id="user-info" style="display: none;">
                        <span id="user-display"></span>
                        <a href="#" id="logout-link">تسجيل الخروج</a>
                    </li>
                </ul>
            </nav>

            <button class="hamburger-menu" id="hamburger-button">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="search-container">
                <form action="/search/" method="get" class="search-form" id="search-form">
                    <input type="search" name="q" placeholder="ابحث عن منتجات..." class="search-input" required>
                </form>
                <button class="search-toggle-btn" id="search-toggle-btn" aria-label="Toggle Search">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="mobile-nav" id="mobile-nav">
        <nav>
            <ul>
                <li class="mobile-categories-item">
                    <details>
                        <summary>
                            <i class="fas fa-tags"></i> الأقسام
                        </summary>
                        <ul class="mobile-categories-list">
                            {% for category in categories %}
                                <li><a href="{% url 'category_products' category.slug %}">{{ category.name }}</a></li>
                            {% endfor %}
                        </ul>
                    </details>
                </li>
                <li><a href="{% url 'index' %}"><i class="fas fa-home"></i> الرئيسية</a></li>
                <li><a href="#"><i class="fas fa-box-open"></i> المنتجات</a></li>
                <li><a href="{% url 'cart' %}"><i class="fas fa-shopping-cart"></i> سلة المشتريات (<span id="cart-count-mobile">0</span>)</a></li>
                <li id="signup-link-mobile"><a href="{% url 'signup' %}"><i class="fas fa-user-plus"></i> إنشاء حساب</a></li>
                <li id="login-link-mobile"><a href="{% url 'login' %}"><i class="fas fa-sign-in-alt"></i> تسجيل الدخول</a></li>
                <li id="user-info-mobile" style="display: none;">
                    <span id="user-display-mobile"></span>
                    <a href="#" id="logout-link-mobile"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="nav-overlay" id="nav-overlay"></div>

    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 سوق الدانة. كل الحقوق محفوظة.</p>
            <div class="footer-links">
                <a href="{% url 'terms' %}">شروط الاستخدام</a>
                <span>|</span>
                <a href="{% url 'privacy' %}">سياسة الخصوصية</a>
            </div>
        </div>
    </footer>

    {% block scripts %}
        <script>
            // ===================================
            // === دوال مساعدة عامة لكل الموقع ===
            // ===================================
            function showSpinner() {
                const spinner = document.getElementById('spinner-overlay');
                if (spinner) spinner.classList.add('show');
            }
    
            function hideSpinner() {
                const spinner = document.getElementById('spinner-overlay');
                if (spinner) spinner.classList.remove('show');
            }
    
            function showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                if (!notification) return;
    
                notification.textContent = message;
                notification.className = 'notification show';
                notification.classList.add(type);
    
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
    
            // ===================================
            // === كود تفعيل شريط البحث ===
            // ===================================
            document.addEventListener('DOMContentLoaded', function() {
                const searchToggleBtn = document.getElementById('search-toggle-btn');
                const searchContainer = document.querySelector('.search-container');
                const searchInput = document.querySelector('.search-input');
    
                if (searchToggleBtn && searchContainer && searchInput) {
                    searchToggleBtn.addEventListener('click', function() {
                        searchContainer.classList.toggle('active');
                        if (searchContainer.classList.contains('active')) {
                            searchInput.focus();
                        }
                    });
                }
            });
        </script>
    {% endblock %}

    </body>
</html>