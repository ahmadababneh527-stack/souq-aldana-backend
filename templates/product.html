{% extends 'base.html' %}
{% load static %}

{% block title %}تفاصيل المنتج - سوق الدانة{% endblock %}

{% block content %}
    {% csrf_token %}
    <div class="product-page-container">
        <div class="product-gallery-container">
            <div class="main-image-wrapper">
                {% if product.images.all %}
    <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
{% else %}
    <img src="https://placehold.co/500x500?text=No+Image" alt="لا توجد صورة">
{% endif %}
            </div>
              <div class="thumbnail-gallery" id="thumbnail-gallery">
    {% for image in product.images.all %}
        <img src="{{ image.image.url }}" alt="صورة مصغرة" class="thumbnail-image">
    {% endfor %}
</div>
        </div>
        
        <div class="product-details-container">
            <h1>{{ product.name }}</h1>
            
            <div id="price-section" class="price-section">
    </div>

           <p class="product-description">{{ product.description }}</p>
            <div class="variant-selector">
    <div id="color-options-container" class="variant-group" style="display: none;">
        <label>اللون:</label>
        <div id="color-options" class="variant-options"></div>
    </div>
    <div id="size-options-container" class="variant-group" style="display: none;">
        <label>المقاس:</label>
        <div id="size-options" class="variant-options"></div>
    </div>
</div>
            <div class="quantity-selector">
                <label for="quantity">الكمية:</label>
                <div class="quantity-controls">
                    <button id="decrease-quantity">-</button>
                    <input type="number" id="quantity" value="1" min="1">
                    <button id="increase-quantity">+</button>
                </div>
            </div>

              <button id="add-to-cart-btn" class="add-to-cart-btn" disabled>اختر الخيارات أولاً</button>
              <div id="variant-status" class="variant-status"></div>
        </div>
    </div>

    <section class="reviews-section">
        <h3>التقييمات (<span id="reviews-count">0</span>)</h3>
        
        {% if user.is_authenticated %}
        <div class="review-form-container">
            <h4>أضف تقييمك</h4>
            <form id="review-form">
                <div class="form-group rating-group">
                    <label>تقييمك:</label>
                    <div class="star-rating">
                        <input type="radio" id="rate-5" name="rating" value="5" required/><label for="rate-5">★</label>
                        <input type="radio" id="rate-4" name="rating" value="4"/><label for="rate-4">★</label>
                        <input type="radio" id="rate-3" name="rating" value="3"/><label for="rate-3">★</label>
                        <input type="radio" id="rate-2" name="rating" value="2"/><label for="rate-2">★</label>
                        <input type="radio" id="rate-1" name="rating" value="1"/><label for="rate-1">★</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="comment">تعليقك:</label>
                    <textarea id="comment" name="comment" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn-primary">إرسال التقييم</button>
                <p id="review-status"></p>
            </form>
        </div>
        {% else %}
        <p><a href="{% url 'login' %}">سجل دخولك</a> لإضافة تقييم.</p>
        {% endif %}

        <div class="reviews-list" id="reviews-list">
            </div>
    </section>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script>
        // تمرير معرّف المنتج من Django إلى الجافاسكريبت
        const PRODUCT_ID = "{{ product.id }}";
    </script>
    <script src="{% static 'js/product-detail.js' %}"></script>
{% endblock %}